import{Ra as g,Ta as E,Ya as h,d as n,f as i,i as a,j as l,m as u,q as r,v as c}from"./chunk-M6627VFI.js";var R=class o{http=r(E);router=r(h);API_URL="/api/auth";TOKEN_KEY="auth_token";USER_KEY="user_info";isAuthenticated=c(this.hasToken());currentUserSubject=new n(this.getUserFromStorage());currentUser$=this.currentUserSubject.asObservable();constructor(){console.log("[AUTH SERVICE] Servicio de autenticaci\xF3n inicializado"),console.log("[AUTH SERVICE] Usuario autenticado:",this.isAuthenticated())}login(e){return console.log("[AUTH SERVICE] Iniciando proceso de login para:",e.email),this.http.post(`${this.API_URL}/login`,e).pipe(l(t=>{console.log("[AUTH SERVICE SUCCESS] Login exitoso"),console.log("[AUTH SERVICE] Token recibido"),console.log("[AUTH SERVICE] Rol del usuario:",t.role),this.setToken(t.token);let s={email:t.email,role:t.role,nombreCompleto:t.nombreCompleto,id:t.id};this.setUserInfo(s),this.currentUserSubject.next(s),this.isAuthenticated.set(!0),console.log("[AUTH SERVICE] Datos de usuario guardados en localStorage")}),a(t=>(console.error("[AUTH SERVICE ERROR] Error en login:",t),console.error("[AUTH SERVICE ERROR] Status:",t.status),console.error("[AUTH SERVICE ERROR] Mensaje:",t.message),i(()=>t))))}logout(){console.log("[AUTH SERVICE] Cerrando sesi\xF3n del usuario"),localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSubject.next(null),this.isAuthenticated.set(!1),console.log("[AUTH SERVICE] Sesi\xF3n cerrada, redirigiendo a login"),this.router.navigate(["/auth/login"])}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}getUserInfo(){return this.getUserFromStorage()}setUserInfo(e){localStorage.setItem(this.USER_KEY,JSON.stringify(e))}getUserFromStorage(){let e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}hasToken(){return!!this.getToken()}getAuthHeaders(){let e=this.getToken();return new g({"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:""})}hasRole(e){let t=this.getUserInfo();return t?t.role===e:!1}getUserRole(){let e=this.getUserInfo();return e?e.role:null}isAdmin(){return this.hasRole("ROLE_ADMIN")}isCliente(){return this.hasRole("ROLE_CLIENTE")}isProfesor(){return this.hasRole("ROLE_PROFESOR")}redirectByRole(){let e=this.getUserRole();switch(console.log("[AUTH SERVICE] Redirigiendo usuario con rol:",e),e){case"ROLE_ADMIN":this.router.navigate(["/admin/estudiantes"]);break;case"ROLE_CLIENTE":this.router.navigate(["/estudiante/horario"]);break;case"ROLE_PROFESOR":this.router.navigate(["/profesor/horario"]);break;default:console.warn("[AUTH SERVICE] Rol no reconocido:",e),this.router.navigate(["/"])}}forgotPassword(e){return console.log("[AUTH SERVICE] Solicitando recuperaci\xF3n para:",e),this.http.post(`${this.API_URL}/forgot-password`,{email:e})}resetPassword(e,t){return console.log("[AUTH SERVICE] Restableciendo contrase\xF1a"),this.http.post(`${this.API_URL}/reset-password`,{token:e,newPassword:t})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})};export{R as a};
