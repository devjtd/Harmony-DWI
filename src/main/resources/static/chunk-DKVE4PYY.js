import{a as R}from"./chunk-XOUSWKTL.js";import{b as V,c as k,d as T,e as N,f as D,g as G,m as W,r as A}from"./chunk-XRDTVXG3.js";import{$ as C,B as a,G as y,H as Z,K as b,Ka as O,Oa as E,S as d,T as o,U as n,V as u,Wa as Y,Xa as J,Ya as I,Za as F,aa as h,ab as _,ba as m,fa as U,ga as S,ha as L,ia as l,ka as w,n as H,pa as x,q as v,qa as M,r as g,ra as P,s as p}from"./chunk-M6627VFI.js";var z=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-layout"]],decls:2,vars:0,template:function(e,i){e&1&&(o(0,"main"),u(1,"router-outlet"),n())},dependencies:[_,J],encapsulation:2})};function te(t,r){if(t&1){let e=C();o(0,"div",27),u(1,"i",28),l(2),o(3,"button",29),h("click",function(){g(e);let s=m();return p(s.clearError())}),n()()}if(t&2){let e=m();a(2),w(" ",e.errorMessage," ")}}function oe(t,r){if(t&1&&(o(0,"div",30),l(1),n()),t&2){let e=m();a(),w(" ",e.emailErrorMsg," ")}}function ie(t,r){if(t&1&&(o(0,"div",30),l(1),n()),t&2){let e=m();a(),w(" ",e.passwordErrorMsg," ")}}function re(t,r){t&1&&(o(0,"span"),l(1," Acceder "),n())}function ne(t,r){t&1&&(o(0,"span"),u(1,"span",31),l(2," Verificando... "),n())}var q=class t{authService=v(R);router=v(I);route=v(Y);loginData={email:"",password:""};isLoading=!1;errorMessage=null;emailInvalid=!1;passwordInvalid=!1;emailErrorMsg="";passwordErrorMsg="";showPassword=!1;returnUrl="/";constructor(){this.returnUrl=this.route.snapshot.queryParams.returnUrl||"/",console.log("[LOGIN COMPONENT] Componente inicializado"),console.log("[LOGIN COMPONENT] URL de retorno:",this.returnUrl)}validateEmail(){let r=this.loginData.email.trim();return r?/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r)?(this.emailInvalid=!1,this.emailErrorMsg="",!0):(this.emailInvalid=!0,this.emailErrorMsg="El formato del correo no es v\xE1lido",!1):(this.emailInvalid=!0,this.emailErrorMsg="El correo electr\xF3nico es obligatorio",!1)}validatePassword(){let r=this.loginData.password;return r?r.length<6?(this.passwordInvalid=!0,this.passwordErrorMsg="La contrase\xF1a debe tener al menos 6 caracteres",!1):(this.passwordInvalid=!1,this.passwordErrorMsg="",!0):(this.passwordInvalid=!0,this.passwordErrorMsg="La contrase\xF1a es obligatoria",!1)}validateAll(){let r=this.validateEmail(),e=this.validatePassword();return r&&e}iniciarSesion(r){if(this.errorMessage=null,console.log("[LOGIN] Iniciando proceso de login"),console.log("[LOGIN] Email:",this.loginData.email),!this.validateAll()){console.log("[LOGIN] Validaci\xF3n fall\xF3");return}r.valid?(this.isLoading=!0,console.log("[LOGIN] Enviando credenciales al servidor"),this.authService.login(this.loginData).subscribe({next:e=>{console.log("[LOGIN SUCCESS] Autenticaci\xF3n exitosa"),console.log("[LOGIN] Rol del usuario:",e.role),console.log("[LOGIN] Nombre:",e.nombreCompleto),this.isLoading=!1,this.authService.redirectByRole()},error:e=>{console.error("[LOGIN ERROR] Error en autenticaci\xF3n:",e),console.error("[LOGIN ERROR] Status:",e.status),this.isLoading=!1,e.status===401?this.errorMessage="Email o contrase\xF1a incorrectos. Por favor, verifica tus credenciales.":e.status===0?this.errorMessage="No se pudo conectar con el servidor. Verifica tu conexi\xF3n a internet.":this.errorMessage="Ocurri\xF3 un error inesperado. Por favor, intenta nuevamente."}})):console.warn("[LOGIN] Formulario inv\xE1lido")}togglePasswordVisibility(){this.showPassword=!this.showPassword}clearError(){this.errorMessage=null}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-login"]],decls:37,vars:21,consts:[["loginForm","ngForm"],[1,"login-container","d-flex","justify-content-center","align-items-center","vh-100"],[1,"header-login"],["routerLink","/",1,"d-flex","align-items-center","text-decoration-none"],["src","/logo.png","alt","Logo Harmony","width","60","height","60",1,"me-2"],[1,"h2","mb-0","text-white"],[1,"card","login-card"],[1,"card-body","p-5"],[1,"card-title","text-center","mb-4"],["class","alert alert-danger alert-dismissible fade show","role","alert",4,"ngIf"],["novalidate","",3,"ngSubmit"],[1,"mb-3"],["for","correo",1,"form-label"],[1,"text-danger"],["type","email","id","correo","name","email","placeholder","tu@ejemplo.com","required","",1,"form-control",3,"ngModelChange","blur","input","ngModel","disabled"],["class","invalid-feedback",4,"ngIf"],[1,"mb-4"],["for","contrasena",1,"form-label"],[1,"input-group"],["id","contrasena","name","password","placeholder","********","required","",1,"form-control",3,"ngModelChange","blur","input","type","ngModel","disabled"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi"],[1,"d-grid","gap-2","mb-3"],["type","submit",1,"btn","btn-primary","btn-login",3,"disabled"],[4,"ngIf"],[1,"text-center","mt-3"],["routerLink","/auth/forgot-password",1,"text-decoration-none","forgot-password-link"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],[1,"bi","bi-exclamation-triangle-fill","me-2"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"invalid-feedback"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,i){if(e&1){let s=C();o(0,"div",1)(1,"div",2)(2,"a",3),u(3,"img",4),o(4,"h1",5),l(5,"Harmony"),n()()(),o(6,"div",6)(7,"div",7)(8,"h2",8),l(9,"Iniciar Sesi\xF3n"),n(),b(10,te,4,1,"div",9),o(11,"form",10,0),h("ngSubmit",function(){g(s);let f=U(12);return p(i.iniciarSesion(f))}),o(13,"div",11)(14,"label",12),l(15," Correo Electr\xF3nico "),o(16,"span",13),l(17,"*"),n()(),o(18,"input",14),P("ngModelChange",function(f){return g(s),M(i.loginData.email,f)||(i.loginData.email=f),p(f)}),h("blur",function(){return g(s),p(i.validateEmail())})("input",function(){return g(s),i.emailInvalid=!1,p(i.clearError())}),n(),b(19,oe,2,1,"div",15),n(),o(20,"div",16)(21,"label",17),l(22," Contrase\xF1a "),o(23,"span",13),l(24,"*"),n()(),o(25,"div",18)(26,"input",19),P("ngModelChange",function(f){return g(s),M(i.loginData.password,f)||(i.loginData.password=f),p(f)}),h("blur",function(){return g(s),p(i.validatePassword())})("input",function(){return g(s),i.passwordInvalid=!1,p(i.clearError())}),n(),o(27,"button",20),h("click",function(){return g(s),p(i.togglePasswordVisibility())}),u(28,"i",21),n(),b(29,ie,2,1,"div",15),n()(),o(30,"div",22)(31,"button",23),b(32,re,2,0,"span",24)(33,ne,3,0,"span",24),n()(),o(34,"p",25)(35,"a",26),l(36," \xBFOlvidaste tu contrase\xF1a? "),n()()()()()()}if(e&2){let s=U(12);S("background-image","url(/fondoLogin.jpg)"),a(10),d("ngIf",i.errorMessage),a(8),L("is-invalid",i.emailInvalid),x("ngModel",i.loginData.email),d("disabled",i.isLoading),a(),d("ngIf",i.emailInvalid),a(7),L("is-invalid",i.passwordInvalid),d("type",i.showPassword?"text":"password"),x("ngModel",i.loginData.password),d("disabled",i.isLoading),a(2),L("bi-eye",!i.showPassword)("bi-eye-slash",i.showPassword),a(),d("ngIf",i.passwordInvalid),a(2),d("disabled",!s.valid||i.isLoading||i.emailInvalid||i.passwordInvalid),a(),d("ngIf",!i.isLoading),a(),d("ngIf",i.isLoading)}},dependencies:[A,G,V,k,T,W,D,N,E,O,_,F],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:flex;flex-direction:column;min-height:100vh;margin:0;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;--login-fondo-texto: #ffffff;--login-card-fondo: #ffffff;--login-card-titulo: #1a1a1a;--login-card-sombra: 0 10px 25px rgba(0, 0, 0, .2);--login-btn-fondo: #724fd2;--login-btn-fondo-hover: #5e3ea1;--login-btn-texto: white;--login-enlace-color: #007bff;--login-enlace-color-hover: #0056b3;--login-label-color: #343a40;--login-placeholder-color: #6c757d}.login-container[_ngcontent-%COMP%]{background-size:cover;background-position:center;background-repeat:no-repeat;background-attachment:fixed;flex-grow:1}.header-login[_ngcontent-%COMP%]{position:absolute;top:25px;left:25px;z-index:10}.header-login[_ngcontent-%COMP%]   .h2[_ngcontent-%COMP%]{color:var(--login-fondo-texto);text-shadow:2px 2px 5px rgba(0,0,0,.8)}.header-login[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 4px 8px #0006}.login-card[_ngcontent-%COMP%]{background-color:var(--login-card-fondo);border-radius:20px;max-width:480px;width:90%;box-shadow:var(--login-card-sombra);border:none}.login-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:3.5rem 2.5rem!important}.login-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{color:var(--login-card-titulo);font-weight:800;font-size:2.5rem;letter-spacing:-.5px}.form-label[_ngcontent-%COMP%]{font-weight:700;color:var(--login-label-color);margin-bottom:.5rem;font-size:1.05rem}.form-control[_ngcontent-%COMP%]{border-radius:10px;border:2px solid #ddd;padding:12px 18px;font-size:1rem;color:var(--login-label-color)}.form-control[_ngcontent-%COMP%]::placeholder{color:var(--login-placeholder-color);opacity:.8}.form-control[_ngcontent-%COMP%]:focus{border-color:var(--login-btn-fondo);box-shadow:0 0 0 .2rem #724fd266;outline:none}.btn-login[_ngcontent-%COMP%]{background-color:var(--login-btn-fondo);border-color:var(--login-btn-fondo);color:var(--login-btn-texto);padding:15px 25px;font-size:1.25rem;font-weight:700;border-radius:10px;letter-spacing:.5px;box-shadow:0 5px 15px #724fd24d}.btn-login[_ngcontent-%COMP%]:hover{background-color:var(--login-btn-fondo-hover);border-color:var(--login-btn-fondo-hover);transform:translateY(-3px);box-shadow:0 8px 20px #724fd266}.forgot-password-link[_ngcontent-%COMP%]{color:var(--login-enlace-color);font-weight:600;font-size:.95rem;transition:color .2s ease}.forgot-password-link[_ngcontent-%COMP%]:hover{color:var(--login-enlace-color-hover);text-decoration:underline}']})};function ae(t,r){if(t&1&&(o(0,"div",13),l(1),n()),t&2){let e=m();a(),w(" ",e.errorMessage," ")}}function se(t,r){if(t&1&&(o(0,"div",14),l(1),n()),t&2){let e=m();a(),w(" ",e.successMessage," ")}}function le(t,r){t&1&&(o(0,"span"),l(1,"Enviar c\xF3digo"),n())}function de(t,r){t&1&&u(0,"span",23)}function ce(t,r){if(t&1){let e=C();o(0,"div")(1,"p",15),l(2,"Ingresa tu correo electr\xF3nico para recibir un c\xF3digo de recuperaci\xF3n."),n(),o(3,"form",16),h("ngSubmit",function(){g(e);let s=m();return p(s.requestToken())}),o(4,"div",17)(5,"label",18),l(6,"Correo Electr\xF3nico"),n(),o(7,"input",19),P("ngModelChange",function(s){g(e);let c=m();return M(c.email,s)||(c.email=s),p(s)}),n()(),o(8,"div",20)(9,"button",21),b(10,le,2,0,"span",10)(11,de,1,0,"span",22),n()()()()}if(t&2){let e=m();a(7),x("ngModel",e.email),d("disabled",e.isLoading),a(2),d("disabled",e.isLoading||!e.email),a(),d("ngIf",!e.isLoading),a(),d("ngIf",e.isLoading)}}function ge(t,r){t&1&&(o(0,"span"),l(1,"Cambiar contrase\xF1a"),n())}function pe(t,r){t&1&&u(0,"span",23)}function me(t,r){if(t&1){let e=C();o(0,"div")(1,"p",15),l(2,"Ingresa el c\xF3digo recibido y tu nueva contrase\xF1a."),n(),o(3,"form",16),h("ngSubmit",function(){g(e);let s=m();return p(s.resetPassword())}),o(4,"div",17)(5,"label",24),l(6,"C\xF3digo de Verificaci\xF3n"),n(),o(7,"input",25),P("ngModelChange",function(s){g(e);let c=m();return M(c.token,s)||(c.token=s),p(s)}),n()(),o(8,"div",17)(9,"label",26),l(10,"Nueva Contrase\xF1a"),n(),o(11,"input",27),P("ngModelChange",function(s){g(e);let c=m();return M(c.newPassword,s)||(c.newPassword=s),p(s)}),n()(),o(12,"div",20)(13,"button",21),b(14,ge,2,0,"span",10)(15,pe,1,0,"span",22),n()()()()}if(t&2){let e=m();a(7),x("ngModel",e.token),d("disabled",e.isLoading),a(4),x("ngModel",e.newPassword),d("disabled",e.isLoading),a(2),d("disabled",e.isLoading||!e.token||!e.newPassword),a(),d("ngIf",!e.isLoading),a(),d("ngIf",e.isLoading)}}var j=class t{authService=v(R);router=v(I);email="";token="";newPassword="";currentStep=1;isLoading=!1;errorMessage=null;successMessage=null;emailInvalid=!1;passwordInvalid=!1;constructor(){console.log("[FORGOT PASSWORD] Componente inicializado")}requestToken(){if(this.errorMessage=null,this.successMessage=null,!this.email){this.errorMessage="Por favor, ingresa tu correo electr\xF3nico.";return}this.isLoading=!0,console.log("[FORGOT PASSWORD] Solicitando token para:",this.email),this.authService.forgotPassword(this.email).subscribe({next:r=>{console.log("[FORGOT PASSWORD] Solicitud enviada:",r),this.isLoading=!1,this.successMessage="Si el correo existe, se ha enviado un c\xF3digo de verificaci\xF3n.",this.currentStep=2},error:r=>{console.error("[FORGOT PASSWORD ERROR]",r),this.isLoading=!1,this.errorMessage=r.error?.error||"Error al solicitar la recuperaci\xF3n."}})}resetPassword(){if(this.errorMessage=null,this.successMessage=null,!this.token||!this.newPassword){this.errorMessage="Todos los campos son obligatorios.";return}if(this.newPassword.length<6){this.errorMessage="La contrase\xF1a debe tener al menos 6 caracteres.";return}this.isLoading=!0,console.log("[FORGOT PASSWORD] Restableciendo contrase\xF1a..."),this.authService.resetPassword(this.token,this.newPassword).subscribe({next:r=>{console.log("[FORGOT PASSWORD] Contrase\xF1a actualizada"),this.isLoading=!1,this.successMessage="Contrase\xF1a actualizada exitosamente. Redirigiendo al login...",setTimeout(()=>{this.router.navigate(["/auth/login"])},2e3)},error:r=>{console.error("[FORGOT PASSWORD ERROR]",r),this.isLoading=!1,this.errorMessage=r.error?.error||"Error al restablecer la contrase\xF1a."}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=y({type:t,selectors:[["app-forgot-password"]],decls:17,vars:6,consts:[[1,"login-container","d-flex","justify-content-center","align-items-center","vh-100"],[1,"header-login"],["routerLink","/",1,"d-flex","align-items-center","text-decoration-none"],["src","/logo.png","alt","Logo Harmony","width","60","height","60",1,"me-2"],[1,"h2","mb-0","text-white"],[1,"card","login-card"],[1,"card-body","p-5"],[1,"card-title","text-center","mb-4"],["class","alert alert-danger","role","alert",4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],[4,"ngIf"],[1,"text-center","mt-3"],["routerLink","/auth/login",1,"text-decoration-none"],["role","alert",1,"alert","alert-danger"],["role","alert",1,"alert","alert-success"],[1,"text-muted","text-center","mb-4"],[3,"ngSubmit"],[1,"mb-3"],["for","email",1,"form-label"],["type","email","id","email","name","email","required","","placeholder","ejemplo@correo.com",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-primary","btn-login",3,"disabled"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["for","token",1,"form-label"],["type","text","id","token","name","token","required","",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","newPassword",1,"form-label"],["type","password","id","newPassword","name","newPassword","required","","placeholder","********",1,"form-control",3,"ngModelChange","ngModel","disabled"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"a",2),u(3,"img",3),o(4,"h1",4),l(5,"Harmony"),n()()(),o(6,"div",5)(7,"div",6)(8,"h2",7),l(9,"Recuperar Contrase\xF1a"),n(),b(10,ae,2,1,"div",8)(11,se,2,1,"div",9)(12,ce,12,5,"div",10)(13,me,16,7,"div",10),o(14,"div",11)(15,"a",12),l(16,"Volver al inicio de sesi\xF3n"),n()()()()()),e&2&&(S("background-image","url(/fondoLogin.jpg)"),a(10),d("ngIf",i.errorMessage),a(),d("ngIf",i.successMessage),a(),d("ngIf",i.currentStep===1),a(),d("ngIf",i.currentStep===2))},dependencies:[A,G,V,k,T,W,D,N,E,O,_,F],styles:['.login-container[_ngcontent-%COMP%]{background-size:cover;background-position:center;background-repeat:no-repeat;position:relative}.login-container[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:#00000080;z-index:1}.header-login[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;z-index:2}.header-login[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))}.header-login[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,.5)}.login-card[_ngcontent-%COMP%]{width:100%;max-width:450px;border:none;border-radius:15px;box-shadow:0 10px 25px #0003;z-index:2;background:#fffffff2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.login-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{color:#333;font-weight:600}.btn-login[_ngcontent-%COMP%]{padding:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;border-radius:8px;transition:all .3s ease}.btn-login[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(var(--bs-primary-rgb),.3)}.form-control[_ngcontent-%COMP%]{padding:12px;border-radius:8px;border:1px solid #dee2e6}.form-control[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px rgba(var(--bs-primary-rgb),.15);border-color:var(--bs-primary)}']})};var ue=[{path:"",component:z,children:[{path:"login",component:q,title:"Harmony - Login"},{path:"forgot-password",component:j,title:"Harmony - Recuperar Contrase\xF1a"},{path:"",redirectTo:"login",pathMatch:"full"},{path:"**",redirectTo:"login"}]}],X=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=Z({type:t});static \u0275inj=H({imports:[_.forChild(ue),_]})};export{X as AuthRoutingModule};
