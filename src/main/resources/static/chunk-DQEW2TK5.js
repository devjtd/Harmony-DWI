import{a as W}from"./chunk-4L3YLO56.js";import{a as P}from"./chunk-XOUSWKTL.js";import{b as D,c as R,d as ae,e as le,f as j,g as se,i as ce,j as de,k as me,m as pe,o as ue,p as ge,r as U}from"./chunk-XRDTVXG3.js";import{$ as y,B as l,G as I,H as A,Ja as ie,K as E,Ka as V,La as ne,O as w,Oa as M,P as T,Q as J,R as K,S as m,T as t,Ta as H,U as i,V as p,Xa as oe,Ya as L,Za as k,_a as re,aa as b,ab as N,ba as c,fa as Q,ia as n,ja as u,ka as _,la as Z,n as O,na as $,pa as x,q as h,qa as C,r as g,ra as S,s as f,xa as ee,ya as te}from"./chunk-M6627VFI.js";var B=class r{authService=h(P);userName="";ngOnInit(){let o=this.authService.getUserInfo();o&&(this.userName=o.nombreCompleto||o.email)}logout(){this.authService.logout()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-layout"]],decls:23,vars:1,consts:[[1,"sidebar","d-flex","flex-column"],[1,"header-logo-dashboard"],[1,"d-flex","align-items-center","text-decoration-none","text-white"],["src","/logo.png","alt","Logo Harmony","width","40","height","40",1,"me-2"],[1,"h5","mb-0","fw-bold"],[1,"user-info"],[1,"bi","bi-person-circle","me-2"],[1,"nav","flex-column","flex-grow-1"],["routerLink","/estudiante/horario","routerLinkActive","active",1,"nav-link-item"],[1,"bi","bi-calendar-check","me-2"],["routerLink","/estudiante/contrasena","routerLinkActive","active",1,"nav-link-item"],[1,"bi","bi-key","me-2"],[1,"mt-auto"],[1,"nav-link-item","nav-link-logout",2,"cursor","pointer",3,"click"],[1,"bi","bi-box-arrow-right","me-2"],[1,"main-content"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"div",1)(2,"a",2),p(3,"img",3),t(4,"h1",4),n(5,"Harmony"),i()()(),t(6,"div",5),p(7,"i",6),t(8,"strong"),n(9),i()(),t(10,"nav",7)(11,"a",8),p(12,"i",9),n(13," Horario de Clases "),i(),t(14,"a",10),p(15,"i",11),n(16," Cambiar Contrase\xF1a "),i(),t(17,"div",12)(18,"a",13),b("click",function(){return a.logout()}),p(19,"i",14),n(20," Cerrar Sesi\xF3n "),i()()()(),t(21,"div",15),p(22,"router-outlet"),i()),e&2&&(l(9),u(a.userName))},dependencies:[M,N,oe,k,re],styles:['@charset "UTF-8";body[_ngcontent-%COMP%]{background-color:#f8f9fa}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;position:fixed;top:0;left:0;padding-top:20px;background-color:#343a40;color:#fff;z-index:1000}.header-logo-dashboard[_ngcontent-%COMP%]{padding:0 20px 20px;border-bottom:1px solid #495057;margin-bottom:15px}.user-info[_ngcontent-%COMP%]{color:#fff;padding:10px 20px;text-align:center;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:10px;font-size:.9rem}.nav-link-item[_ngcontent-%COMP%]{color:#fffc;padding:15px 20px;text-decoration:none;display:block;transition:background-color .2s,color .2s}.nav-link-item[_ngcontent-%COMP%]:hover, .nav-link-item.active[_ngcontent-%COMP%]{background-color:#495057;color:#fff}.nav-link-logout[_ngcontent-%COMP%]{color:#dc3545}.nav-link-logout[_ngcontent-%COMP%]:hover{background-color:#495057;color:#dc3545}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px;min-height:100vh}']})};function _e(r,o){if(r&1&&(t(0,"div",17)(1,"h4",18),p(2,"i",19),n(3),i(),t(4,"p",20)(5,"strong"),n(6,"Fecha:"),i(),n(7),ee(8,"date"),i(),t(9,"p",20)(10,"strong"),n(11,"Motivo:"),i(),n(12),i(),p(13,"hr"),t(14,"p",21)(15,"strong"),n(16,"Acci\xF3n:"),i(),n(17),i()()),r&2){let e=o.$implicit;l(3),_("Clase Cancelada: ",e.tallerNombre),l(4),_(" ",te(8,4,e.fecha,"fullDate")),l(5),_(" ",e.motivo),l(5),_(" ",e.accion)}}function xe(r,o){if(r&1&&(t(0,"div",13)(1,"h3",14),p(2,"i",15),n(3,"Avisos Importantes"),i(),E(4,_e,18,7,"div",16),i()),r&2){let e=c();l(4),m("ngForOf",e.avisos)}}function Ce(r,o){r&1&&(t(0,"div",22)(1,"div",23)(2,"span",24),n(3,"Cargando..."),i()(),t(4,"p",25),n(5,"Cargando tus horarios..."),i()())}function Se(r,o){if(r&1&&(t(0,"div",17),p(1,"i",15),n(2),i()),r&2){let e=c();l(2),_(" ",e.errorMessage," ")}}function Ie(r,o){r&1&&(t(0,"div",26),p(1,"i",27),n(2," A\xFAn no tienes horarios asignados. "),i())}function Ee(r,o){if(r&1){let e=y();t(0,"tr")(1,"td"),n(2),i(),t(3,"td"),n(4),i(),t(5,"td"),n(6),i(),t(7,"td"),n(8),i(),t(9,"td"),n(10),i(),t(11,"td")(12,"button",36),b("click",function(){let s=g(e).$implicit,d=c(2);return f(d.solicitarBaja(s))}),p(13,"i",37),n(14," Solicitar Baja "),i()()()}if(r&2){let e=o.$implicit,a=c(2);l(2),u(e.taller.nombre),l(2),u(e.diasDeClase),l(2),u(a.formatHora(e.horaInicio)),l(2),u(a.formatHora(e.horaFin)),l(2),u(e.profesor.nombreCompleto)}}function ye(r,o){if(r&1&&(t(0,"div",28)(1,"h3",29),p(2,"i",30),n(3,"Horarios en Progreso"),i(),t(4,"div",31)(5,"table",32)(6,"thead",33)(7,"tr")(8,"th",34),n(9,"Taller"),i(),t(10,"th",34),n(11,"D\xEDa(s)"),i(),t(12,"th",34),n(13,"Hora Inicio"),i(),t(14,"th",34),n(15,"Hora Fin"),i(),t(16,"th",34),n(17,"Profesor"),i(),t(18,"th",34),n(19,"Acciones"),i()()(),t(20,"tbody"),E(21,Ee,15,5,"tr",35),i()()()()),r&2){let e=c();l(21),m("ngForOf",e.horariosActivos)}}function Me(r,o){if(r&1&&(t(0,"tr")(1,"td"),n(2),i(),t(3,"td"),n(4),i(),t(5,"td"),n(6),i(),t(7,"td"),n(8),i(),t(9,"td"),n(10),i(),t(11,"td"),n(12),i(),t(13,"td")(14,"span",42),n(15,"Finalizado"),i()()()),r&2){let e=o.$implicit,a=c(2);l(2),u(e.taller.nombre),l(2),u(e.diasDeClase),l(2),u(a.formatHora(e.horaInicio)),l(2),u(a.formatHora(e.horaFin)),l(2),u(e.profesor.nombreCompleto),l(2),u(e.fechaFin||"N/A")}}function we(r,o){if(r&1&&(t(0,"div",28)(1,"h3",38),p(2,"i",39),n(3,"Horarios Finalizados"),i(),t(4,"div",31)(5,"table",40)(6,"thead",41)(7,"tr")(8,"th",34),n(9,"Taller"),i(),t(10,"th",34),n(11,"D\xEDa(s)"),i(),t(12,"th",34),n(13,"Hora Inicio"),i(),t(14,"th",34),n(15,"Hora Fin"),i(),t(16,"th",34),n(17,"Profesor"),i(),t(18,"th",34),n(19,"Fecha Fin"),i(),t(20,"th",34),n(21,"Estado"),i()()(),t(22,"tbody"),E(23,Me,16,6,"tr",35),i()()()()),r&2){let e=c();l(23),m("ngForOf",e.horariosFinalizados)}}var z=class r{authService=h(P);http=h(H);inscripcionService=h(W);userName="";horariosActivos=[];horariosFinalizados=[];avisos=[];isLoading=!0;errorMessage=null;API_URL="http://localhost:8080/api/cliente/horarios";ngOnInit(){console.log("[HORARIO ESTUDIANTE] Inicializando componente");let o=this.authService.getUserInfo();o&&(this.userName=o.nombreCompleto||o.email),this.cargarHorarios()}cargarHorarios(){console.log("[HORARIO ESTUDIANTE] Cargando horarios del estudiante"),this.http.get(this.API_URL).subscribe({next:o=>{console.log("[HORARIO ESTUDIANTE] Horarios cargados:",o.length),this.horariosActivos=o.filter(e=>!e.finalizado),this.horariosFinalizados=o.filter(e=>e.finalizado),this.avisos=[],o.forEach(e=>{e.cancelaciones&&e.cancelaciones.length>0&&e.cancelaciones.forEach(a=>{this.avisos.push({tallerNombre:e.taller.nombre,fecha:a.fecha,motivo:a.motivo,accion:a.accion})})}),this.isLoading=!1},error:o=>{console.error("[HORARIO ESTUDIANTE] Error al cargar horarios:",o),this.errorMessage="No se pudieron cargar los horarios. Por favor, intenta m\xE1s tarde.",this.isLoading=!1}})}formatHora(o){return o.substring(0,5)}solicitarBaja(o){let e=prompt(`Por favor, indica el motivo de la baja para el taller ${o.taller.nombre}: `);if(e===null)return;if(e.trim().length<5){alert("Por favor, ingresa un motivo v\xE1lido (m\xEDnimo 5 caracteres).");return}let a=this.authService.getUserInfo();if(!a||!a.id){alert("Error: No se pudo identificar al usuario.");return}let s={clienteId:a.id,horarioId:o.id,motivo:e};console.log("[HORARIO ESTUDIANTE] Solicitando baja:",s),this.http.post("http://localhost:8080/api/inscripcion/solicitar-baja",s).subscribe({next:d=>{console.log("\u2705 [HORARIO ESTUDIANTE] Solicitud enviada:",d),alert("Tu solicitud de baja ha sido enviada al administrador. Te contactaremos pronto.")},error:d=>{console.error("\u274C [HORARIO ESTUDIANTE] Error al solicitar baja:",d),alert("Hubo un error al procesar tu solicitud. Por favor, intenta nuevamente.")}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-horario"]],decls:18,vars:7,consts:[[1,"main-content"],[1,"mb-4","text-harmony-title"],["id","horario",1,"calendar-container"],[1,"h3","mb-4","text-harmony-title"],[1,"lead","text-muted"],["class","mb-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],["class","alert alert-warning","role","alert",4,"ngIf"],["class","mb-5",4,"ngIf"],[1,"mt-4","text-center"],["routerLink","/estudiante/nueva-inscripcion",1,"btn","btn-primary"],[1,"bi","bi-plus-circle","me-2"],[1,"mb-4"],[1,"h5","text-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],["class","alert alert-danger","role","alert",4,"ngFor","ngForOf"],["role","alert",1,"alert","alert-danger"],[1,"alert-heading","h6"],[1,"bi","bi-calendar-x","me-2"],[1,"mb-1"],[1,"mb-0"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-3","text-muted"],["role","alert",1,"alert","alert-warning"],[1,"bi","bi-info-circle-fill","me-2"],[1,"mb-5"],[1,"h5","text-primary","mb-3"],[1,"bi","bi-calendar-check","me-2"],[1,"table-responsive"],[1,"table","table-bordered","table-striped","text-center","align-middle"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-exclamation-circle","me-1"],[1,"h5","text-secondary","mb-3"],[1,"bi","bi-archive-fill","me-2"],[1,"table","table-bordered","table-secondary","text-center","align-middle","opacity-75"],[1,"table-secondary"],[1,"badge","bg-secondary"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"h1",1),n(2),i(),t(3,"section",2)(4,"h2",3),n(5,"Tus Horarios de Taller"),i(),t(6,"p",4),n(7,"Aqu\xED puedes ver los horarios de tus clases de los talleres en los que est\xE1s inscrito. "),i(),E(8,xe,5,1,"div",5)(9,Ce,6,0,"div",6)(10,Se,3,1,"div",7)(11,Ie,3,0,"div",8)(12,ye,22,1,"div",9)(13,we,24,1,"div",9),t(14,"div",10)(15,"button",11),p(16,"i",12),n(17," Inscribirse a Nuevo Taller "),i()()()()),e&2&&(l(2),_("Bienvenido, ",a.userName),l(6),m("ngIf",a.avisos.length>0),l(),m("ngIf",a.isLoading),l(),m("ngIf",a.errorMessage&&!a.isLoading),l(),m("ngIf",!a.isLoading&&!a.errorMessage&&a.horariosActivos.length===0&&a.horariosFinalizados.length===0),l(),m("ngIf",!a.isLoading&&!a.errorMessage&&a.horariosActivos.length>0),l(),m("ngIf",!a.isLoading&&!a.errorMessage&&a.horariosFinalizados.length>0))},dependencies:[M,ie,V,N,k,ne],styles:['@charset "UTF-8";.calendar-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:20px;box-shadow:0 4px 12px #0000001a}.table-dark[_ngcontent-%COMP%]{--bs-table-bg: #212529;color:#fff}.text-harmony-title[_ngcontent-%COMP%]{color:#5e3ea1!important;font-weight:700;text-shadow:1px 1px 2px rgba(0,0,0,.1)}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem}']})};function Ne(r,o){if(r&1&&(t(0,"div",22),p(1,"i",23),t(2,"span"),n(3),i()()),r&2){let e=c();l(3),u(e.successMessage)}}function Pe(r,o){if(r&1&&(t(0,"div",24),p(1,"i",25),t(2,"span"),n(3),i()()),r&2){let e=c();l(3),u(e.errorMessage)}}function Fe(r,o){r&1&&(t(0,"span"),n(1,"Confirmar Cambio"),i())}function Oe(r,o){r&1&&(t(0,"span"),p(1,"span",26),n(2," Cambiando... "),i())}var q=class r{http=h(H);router=h(L);nuevaContrasena="";confirmarContrasena="";successMessage=null;errorMessage=null;isLoading=!1;API_URL="http://localhost:8080/api/cliente/cambiar-clave";ngOnInit(){console.log("[CAMBIO CONTRASE\xD1A ESTUDIANTE] Componente inicializado")}cambiarContrasena(o){if(this.successMessage=null,this.errorMessage=null,o.invalid){this.errorMessage="Por favor, completa todos los campos.";return}if(this.nuevaContrasena!==this.confirmarContrasena){this.errorMessage="Las contrase\xF1as no coinciden.";return}if(this.nuevaContrasena.length<6){this.errorMessage="La contrase\xF1a debe tener al menos 6 caracteres.";return}this.isLoading=!0,console.log("[CAMBIO CONTRASE\xD1A ESTUDIANTE] Enviando solicitud de cambio");let e={nuevaContrasena:this.nuevaContrasena,confirmarContrasena:this.confirmarContrasena};this.http.post(this.API_URL,e,{responseType:"text"}).subscribe({next:()=>{console.log("[CAMBIO CONTRASE\xD1A ESTUDIANTE] Contrase\xF1a cambiada exitosamente"),this.successMessage="\xA1Contrase\xF1a cambiada exitosamente! Ser\xE1s redirigido al login...",this.isLoading=!1,o.resetForm(),setTimeout(()=>{this.router.navigate(["/auth/login"])},3e3)},error:a=>{console.error("[CAMBIO CONTRASE\xD1A ESTUDIANTE] Error al cambiar contrase\xF1a:",a);let s=a.error||"Hubo un error al cambiar la contrase\xF1a. Por favor, intenta nuevamente.";this.errorMessage=s,this.isLoading=!1}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-contrasena"]],decls:34,vars:9,consts:[["passwordForm","ngForm"],[1,"main-content"],[1,"mb-4"],["id","cambio-contrasena",1,"password-container"],[1,"h3","mb-4","text-warning"],["class","alert alert-success","role","alert",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-warning"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"h4","mb-3"],[1,"row","justify-content-center"],[1,"col-lg-8"],[1,"mt-4",3,"ngSubmit"],[1,"mb-3"],["for","nuevaContrasena",1,"form-label","fw-bold"],["type","password","id","nuevaContrasena","name","nuevaContrasena","required","","minlength","6","placeholder","M\xEDnimo 6 caracteres",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"form-text","text-muted"],["for","confirmarContrasena",1,"form-label","fw-bold"],["type","password","id","confirmarContrasena","name","confirmarContrasena","required","","minlength","6","placeholder","Vuelve a escribir la nueva contrase\xF1a",1,"form-control",3,"ngModelChange","ngModel","disabled"],[1,"d-grid"],["type","submit",1,"btn","btn-primary","btn-lg","btn-confirmar-password",3,"disabled"],[4,"ngIf"],["role","alert",1,"alert","alert-success"],[1,"bi","bi-check-circle-fill","me-2"],["role","alert",1,"alert","alert-danger"],[1,"bi","bi-exclamation-octagon-fill","me-2"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(e,a){if(e&1){let s=y();t(0,"div",1)(1,"h1",2),n(2,"Configuraci\xF3n de Seguridad"),i(),t(3,"section",3)(4,"h2",4),n(5,"\xA1Advertencia de Seguridad!"),i(),E(6,Ne,4,1,"div",5)(7,Pe,4,1,"div",6),t(8,"div",7),p(9,"i",8),n(10," Recomendamos "),t(11,"strong"),n(12,"encarecidamente"),i(),n(13," que cambies tu contrase\xF1a temporal o inicial inmediatamente para proteger tu cuenta. "),i(),t(14,"h3",9),n(15,"Establecer Nueva Contrase\xF1a"),i(),t(16,"div",10)(17,"div",11)(18,"form",12,0),b("ngSubmit",function(){g(s);let v=Q(19);return f(a.cambiarContrasena(v))}),t(20,"div",13)(21,"label",14),n(22,"Nueva Contrase\xF1a"),i(),t(23,"input",15),S("ngModelChange",function(v){return g(s),C(a.nuevaContrasena,v)||(a.nuevaContrasena=v),f(v)}),i(),t(24,"small",16),n(25,"M\xEDnimo 6 caracteres, se recomienda incluir may\xFAsculas y n\xFAmeros"),i()(),t(26,"div",2)(27,"label",17),n(28,"Confirmar Nueva Contrase\xF1a"),i(),t(29,"input",18),S("ngModelChange",function(v){return g(s),C(a.confirmarContrasena,v)||(a.confirmarContrasena=v),f(v)}),i()(),t(30,"div",19)(31,"button",20),E(32,Fe,2,0,"span",21)(33,Oe,3,0,"span",21),i()()()()()()()}if(e&2){let s=Q(19);l(6),m("ngIf",a.successMessage),l(),m("ngIf",a.errorMessage),l(16),x("ngModel",a.nuevaContrasena),m("disabled",a.isLoading),l(6),x("ngModel",a.confirmarContrasena),m("disabled",a.isLoading),l(2),m("disabled",s.invalid||a.isLoading),l(),m("ngIf",!a.isLoading),l(),m("ngIf",a.isLoading)}},dependencies:[M,V,U,se,D,R,ae,pe,ue,j,le],styles:[".password-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:30px;box-shadow:0 4px 12px #0000001a}.password-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{padding:10px 15px;border-radius:6px}.btn-confirmar-password[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff;font-weight:700;padding:10px 20px;transition:background-color .3s ease}.btn-confirmar-password[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3;border-color:#0056b3}.btn-confirmar-password[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})};var fe=(r,o)=>o.id;function Ae(r,o){r&1&&(t(0,"div",2)(1,"div",5)(2,"span",6),n(3,"Cargando..."),i()()())}function Ve(r,o){if(r&1&&(t(0,"div",3),n(1),i()),r&2){let e=c();l(),_(" ",e.errorMessage," ")}}function He(r,o){if(r&1&&(t(0,"option",12),n(1),i()),r&2){let e=o.$implicit;m("ngValue",e.id),l(),Z(" ",e.nombre," - S/ ",e.precio," ")}}function Le(r,o){if(r&1&&(t(0,"option",12),n(1),i()),r&2){let e=o.$implicit;m("ngValue",e.id),l(),$(" ",e.diasDeClase," ",e.horaInicio,"-",e.horaFin," (Prof. ",(e.profesor==null?null:e.profesor.nombreCompleto)||"Sin asignar",") ")}}function ke(r,o){if(r&1){let e=y();t(0,"div",8)(1,"label",9),n(2,"Selecciona un Horario"),i(),t(3,"select",15),S("ngModelChange",function(s){g(e);let d=c(3);return C(d.horarioSeleccionadoId,s)||(d.horarioSeleccionadoId=s),f(s)}),t(4,"option",11),n(5,"-- Selecciona --"),i(),J(6,Le,2,5,"option",12,fe),i()()}if(r&2){let e=c(3);l(3),x("ngModel",e.horarioSeleccionadoId),l(),m("ngValue",null),l(2),K(e.horariosDisponibles)}}function De(r,o){if(r&1){let e=y();t(0,"div")(1,"div",8)(2,"label",9),n(3,"Selecciona un Taller"),i(),t(4,"select",10),S("ngModelChange",function(s){g(e);let d=c(2);return C(d.tallerSeleccionadoId,s)||(d.tallerSeleccionadoId=s),f(s)}),b("change",function(){g(e);let s=c(2);return f(s.horarioSeleccionadoId=null)}),t(5,"option",11),n(6,"-- Selecciona --"),i(),J(7,He,2,3,"option",12,fe),i()(),w(9,ke,8,2,"div",8),t(10,"div",13)(11,"button",14),b("click",function(){g(e);let s=c(2);return f(s.iniciarProcesoPago())}),n(12," Continuar al Pago "),i()()()}if(r&2){let e=c(2);l(4),x("ngModel",e.tallerSeleccionadoId),l(),m("ngValue",null),l(2),K(e.talleres),l(2),T(e.tallerSeleccionadoId?9:-1),l(2),m("disabled",!e.tallerSeleccionadoId||!e.horarioSeleccionadoId)}}function Re(r,o){if(r&1){let e=y();t(0,"div")(1,"h4",16),n(2,"Detalles de Pago"),i(),t(3,"div",17)(4,"small"),n(5,"Ingrese los datos de su tarjeta para completar la inscripci\xF3n."),i()(),t(6,"div",8)(7,"label",9),n(8,"N\xFAmero de Tarjeta"),i(),t(9,"input",18),S("ngModelChange",function(s){g(e);let d=c(2);return C(d.datosPago.numeroTarjeta,s)||(d.datosPago.numeroTarjeta=s),f(s)}),i()(),t(10,"div",19)(11,"div",20)(12,"label",9),n(13,"Vencimiento (MM/YY)"),i(),t(14,"input",21),S("ngModelChange",function(s){g(e);let d=c(2);return C(d.datosPago.fechaVencimiento,s)||(d.datosPago.fechaVencimiento=s),f(s)}),i()(),t(15,"div",20)(16,"label",9),n(17,"CVV"),i(),t(18,"input",22),S("ngModelChange",function(s){g(e);let d=c(2);return C(d.datosPago.cvv,s)||(d.datosPago.cvv=s),f(s)}),i()()(),t(19,"div",23)(20,"button",24),b("click",function(){g(e);let s=c(2);return f(s.cancelarPago())}),n(21," Atr\xE1s "),i(),t(22,"button",25),b("click",function(){g(e);let s=c(2);return f(s.inscribirse())}),n(23," Pagar e Inscribirse "),i()()()}if(r&2){let e=c(2);l(9),x("ngModel",e.datosPago.numeroTarjeta),l(5),x("ngModel",e.datosPago.fechaVencimiento),l(4),x("ngModel",e.datosPago.cvv),l(4),m("disabled",!e.validarPago())}}function je(r,o){if(r&1&&(t(0,"div",4)(1,"div",7),w(2,De,13,4,"div"),w(3,Re,24,4,"div"),i()()),r&2){let e=c();l(2),T(e.mostrarFormularioPago?-1:2),l(),T(e.mostrarFormularioPago?3:-1)}}var Y=class r{inscripcionService=h(W);authService=h(P);router=h(L);talleres=[];tallerSeleccionadoId=null;horarioSeleccionadoId=null;isLoading=!0;errorMessage=null;inscripcionesCliente=[];mostrarFormularioPago=!1;datosPago={numeroTarjeta:"",fechaVencimiento:"",cvv:""};ngOnInit(){this.cargarDatosIniciales()}cargarDatosIniciales(){this.isLoading=!0;let o=this.authService.getUserInfo();o&&o.id?this.inscripcionService.obtenerInscripcionesPorCliente(o.id).subscribe({next:e=>{this.inscripcionesCliente=e,this.cargarTalleres()},error:e=>{console.error("Error al cargar inscripciones",e),this.cargarTalleres()}}):this.cargarTalleres()}cargarTalleres(){this.inscripcionService.obtenerTalleres().subscribe({next:o=>{this.talleres=o,this.filtrarHorariosInscritos(),this.isLoading=!1},error:o=>{console.error("Error al cargar talleres",o),this.errorMessage="No se pudieron cargar los talleres disponibles.",this.isLoading=!1}})}filtrarHorariosInscritos(){if(!this.inscripcionesCliente.length)return;let o=this.inscripcionesCliente.map(e=>e.horario?.id);this.talleres.forEach(e=>{e.horarios&&(e.horarios=e.horarios.filter(a=>!o.includes(a.id)))})}get horariosDisponibles(){if(!this.tallerSeleccionadoId)return[];let o=this.talleres.find(e=>e.id===this.tallerSeleccionadoId);return o?o.horarios:[]}iniciarProcesoPago(){!this.tallerSeleccionadoId||!this.horarioSeleccionadoId||(this.mostrarFormularioPago=!0)}cancelarPago(){this.mostrarFormularioPago=!1,this.datosPago={numeroTarjeta:"",fechaVencimiento:"",cvv:""}}validarPago(){let{numeroTarjeta:o,fechaVencimiento:e,cvv:a}=this.datosPago,s=/^\d{15,19}$/.test(o.replace(/\s/g,"")),d=/^(0[1-9]|1[0-2])\/\d{2}$/.test(e),v=/^\d{3,4}$/.test(a);return s&&d&&v}inscribirse(){if(!this.validarPago()){alert("Por favor, ingrese datos de pago v\xE1lidos.");return}let o=this.authService.getUserInfo();if(!o||!o.id){this.errorMessage="No se pudo identificar al usuario.";return}let e={clienteId:o.id,horarioId:this.horarioSeleccionadoId};this.inscripcionService.inscribirEstudiante(e).subscribe({next:()=>{alert("\xA1Inscripci\xF3n realizada con \xE9xito!"),this.router.navigate(["/estudiante/horario"])},error:a=>{console.error("Error al inscribir",a),this.errorMessage="Hubo un error al procesar la inscripci\xF3n. Int\xE9ntalo de nuevo."}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-nueva-inscripcion"]],decls:6,vars:3,consts:[[1,"container","mt-4"],[1,"mb-4","text-harmony-title"],[1,"text-center","py-5"],[1,"alert","alert-danger"],[1,"card","shadow-sm"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"card-body"],[1,"mb-3"],[1,"form-label"],[1,"form-select",3,"ngModelChange","change","ngModel"],["disabled","",3,"ngValue"],[3,"ngValue"],[1,"d-grid"],[1,"btn","btn-primary",3,"click","disabled"],[1,"form-select",3,"ngModelChange","ngModel"],[1,"mb-3","text-primary"],[1,"alert","alert-info"],["type","text","placeholder","0000 0000 0000 0000","maxlength","19",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-md-6","mb-3"],["type","text","placeholder","MM/YY","maxlength","5",1,"form-control",3,"ngModelChange","ngModel"],["type","password","placeholder","123","maxlength","4",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","justify-content-between","mt-4"],[1,"btn","btn-outline-secondary",3,"click"],[1,"btn","btn-success",3,"click","disabled"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"h2",1),n(2,"Inscribirse en un Nuevo Taller"),i(),w(3,Ae,4,0,"div",2),w(4,Ve,2,1,"div",3),w(5,je,4,2,"div",4),i()),e&2&&(l(3),T(a.isLoading?3:-1),l(),T(a.errorMessage?4:-1),l(),T(!a.isLoading&&!a.errorMessage?5:-1))},dependencies:[U,de,me,D,ce,R,ge,j],encapsulation:2})};var Ue=[{path:"",component:B,children:[{path:"",redirectTo:"horario",pathMatch:"full"},{path:"horario",component:z,title:"Harmony - Estudiante: Mi Horario"},{path:"nueva-inscripcion",component:Y,title:"Harmony - Estudiante: Nueva Inscripci\xF3n"},{path:"contrasena",component:q,title:"Harmony - Estudiante: Cambiar Contrase\xF1a"},{path:"**",redirectTo:"horario"}]}],G=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=A({type:r});static \u0275inj=O({imports:[N.forChild(Ue),N]})};var he=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=A({type:r});static \u0275inj=O({imports:[M,G]})};export{he as EstudianteModule};
